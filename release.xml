<?xml version="1.0" encoding="UTF-8"?>
<project basedir="." default="jar" name="4dbb">
    <property name="4dbb.location" value="C:/projects/4dbb"/>
    <property name="dest" value="C:\projects\web_ee\server\html\math\4dbb"/>

	<property name="server_url" value="http://math.eretrandre.org"/>
	
	<property name="src_dir" value="src"/>
	<property name="extsrc_dir" value="extsrc"/>
    <property name="html_dir" value="html"/>
    <property name="release_dir" value="export"/>

    <property name="jar" value="4dbb.jar"/>
	<property name="jar_url" value="${server_url}/4dbb/${jar}"/>
	
	<property name="application_properties" value="${src_dir}/ddddbb/game/application.properties"/>
	<property file="${application_properties}"/>
    <tstamp>
        <format property="build_time" pattern="yyyyMMdd-HHmmss" locale="en"/>
    	<format property="build_htime" pattern="yyyy-MM-dd HH:mm" locale="en"/>
    </tstamp>


    <property name="rproperties" value="${release_dir}/release.properties"/>
	<delete file="${rproperties}"/>
	
	<echo file="${rproperties}">
svn_number=</echo>
	<exec executable="svnversion" append="true" output="${rproperties}">
        <arg value="-n"/>
    </exec>
	<property file="${rproperties}"/>

	<property name="applet_version" value="${version}.${svn_number}"/>
    

    <echo file="${rproperties}">
#This file is generated automaticly, do not edit!
build_time=${build_time}
build_htime=${build_htime}
release_version=${version}
svn_number=${svn_number}
applet_version=${applet_version}
copyright=${copyright_html}
email=${email}
jar=${jar}
jar_url=${jar_url}
	</echo>
	
    <property name="bin_out" value="${release_dir}/bin"/>
	<property name="html_out" value="${release_dir}/html"/>
    <property name="jar_out" value="${release_dir}/${jar}"/>
    
 	<target name="jar">
 		<delete file="${jar_out}"/>
		<delete dir="${bin_out}"/> 		
 		<mkdir dir="${bin_out}"/>
        <copy todir="${bin_out}">
            <fileset dir="${src_dir}">
                <include name="**/*.properties"/>
                <include name="**/*.html"/>
                <include name="**/*.MF"/>
            </fileset>
            <filterset>
                <filtersfile file="${rproperties}"/>
				<filtersfile file="${application_properties}"/>
            </filterset>
        </copy>
		<copy todir="${bin_out}">
			<fileset dir="${src_dir}">
		    	<include name="**/*.wav"/>
			</fileset>
		</copy>
    	<javac destdir="${bin_out}" srcdir="${src_dir}">
            <src path="${src_dir}"/>
            <src path="${extsrc_dir}"/>
            <include name="${application_src}"/>
            <include name="${applet_src}"/>
        </javac>
        <jar destfile="${jar_out}" basedir="${bin_out}">
            <manifest>
                <attribute name="Main-Class" value="${application_class}"/>
            </manifest>
        </jar> 		
 	</target>
	
	<target name="web">
		<delete dir="${html_out}"/>
    	<mkdir dir="${html_out}"/>
        <copy todir="${html_out}" overwrite="true">
            <fileset dir="${html_dir}">
            	<exclude name="**/*.png"/>
            	<exclude name="**/*.jpg"/>
            	<exclude name="**/*.gif"/>
            </fileset>
            <filterset>
                <filtersfile file="${rproperties}"/>
				<filtersfile file="${application_properties}"/>
            </filterset>
        </copy>
        <copy todir="${html_out}" overwrite="true">
            <fileset dir="${html_dir}">
            	<include name="**/*.png"/>
            	<include name="**/*.jpg"/>
            	<include name="**/*.gif"/>
            </fileset>
        </copy>
        <copy todir="${html_out}" file="${bin_out}/ddddbb/gui/documentation.html"/>
		<copy todir="${html_out}" file="${jar_out}"/>
    </target>
    
 </project>
